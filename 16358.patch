From cadcbdf638266d3c785e969e49801c79e8fb7f53 Mon Sep 17 00:00:00 2001
From: Oliver Brakmann <ob-web2013+github@posteo.net>
Date: Wed, 27 Mar 2019 00:49:33 +0100
Subject: [PATCH] Fix crash due to conflicting access to collection in killed
 Cargo

---
 OpenRA.Mods.Common/Traits/Passenger.cs | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/OpenRA.Mods.Common/Traits/Passenger.cs b/OpenRA.Mods.Common/Traits/Passenger.cs
index d4f6ae8e79d..912dba75636 100644
--- a/OpenRA.Mods.Common/Traits/Passenger.cs
+++ b/OpenRA.Mods.Common/Traits/Passenger.cs
@@ -189,7 +189,9 @@ void INotifyKilled.Killed(Actor self, AttackInfo e)
 			if (Transport == null)
 				return;
 
-			Transport.Trait<Cargo>().Unload(Transport, self);
+			// Something killed us, but it wasn't our transport blowing up. Remove us from the cargo.
+			if (!Transport.IsDead)
+				Transport.Trait<Cargo>().Unload(Transport, self);
 		}
 	}
 }
