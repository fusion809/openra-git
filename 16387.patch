From b0441712b37d39ec5be47d7eca079b7b08da7cc7 Mon Sep 17 00:00:00 2001
From: tovl <tomvanleth@gmail.com>
Date: Fri, 5 Apr 2019 20:43:03 +0200
Subject: [PATCH] Fix crash in FindAndDeliverResources.GetSearchFromLocation.

---
 OpenRA.Mods.Common/Activities/FindAndDeliverResources.cs | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/OpenRA.Mods.Common/Activities/FindAndDeliverResources.cs b/OpenRA.Mods.Common/Activities/FindAndDeliverResources.cs
index 44f8e40a1bc..3125eabcec0 100644
--- a/OpenRA.Mods.Common/Activities/FindAndDeliverResources.cs
+++ b/OpenRA.Mods.Common/Activities/FindAndDeliverResources.cs
@@ -223,10 +223,10 @@ public override IEnumerable<Target> GetTargets(Actor self)
 
 		CPos GetSearchFromLocation(Actor self)
 		{
-			if (harv.LastLinkedProc != null)
+			if (harv.LastLinkedProc != null && !harv.LastLinkedProc.IsDead && harv.LastLinkedProc.IsInWorld)
 				return harv.LastLinkedProc.Location + harv.LastLinkedProc.Trait<IAcceptResources>().DeliveryOffset;
 
-			if (harv.LinkedProc != null)
+			if (harv.LinkedProc != null && !harv.LinkedProc.IsDead && harv.LinkedProc.IsInWorld)
 				return harv.LinkedProc.Location + harv.LinkedProc.Trait<IAcceptResources>().DeliveryOffset;
 
 			return self.Location;
